<?php defined('SYSPATH') or die('No direct script access.');

class Task_Serverstats_Update_LocalSphinxStatus extends Minion_Task
{
    
	protected function _execute(array $params)
    {
        Task_Helper::createWorker('Serverstats:Update:LocalSphinxStatus', $this);
	}

    public function Worker(GearmanJob $job)
    {
        $server = Kohana::$config->load('sphinxql.default.servers.sphinx_01');
    	$server_param = explode(':', $server);
        $connection = new mysqli($server_param[0], null, null, null, $server_param[1], null);
        if ( $connection->connect_errno )
        {
            $result = '<span class="text-danger">Error</span>';
        }
        else
        {
            $connection->close();
            $result = '<span class="text-success">OK</span>';
        }

        Model_Serverstat::setStat('LocalSphinxStatus', $result);
    }
    
}