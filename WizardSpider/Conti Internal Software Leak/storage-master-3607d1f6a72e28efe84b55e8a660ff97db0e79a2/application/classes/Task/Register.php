<?php defined('SYSPATH') or die('No direct script access.');

class Task_Register extends Minion_Task
{
    protected function _execute(array $params)
    {
        $user = ORM::factory('User');
        $user->username = 'root';
        $user->password = 'NU(G8ydsgsdg7';
        $user->save();
        $user->add('roles', [
            ORM::factory('Role', ['name' => 'login']),
            ORM::factory('Role', ['name' => 'admin'])
        ]);

        DB::insert('actions', ['name', 'description', 'menu_title'])
            ->values(
                [
                    'name' => 'Logpost',
                    'description' => 'Logpost',
                    'menu_title' => 'Logpost'
                ],
                [
                    'name' => 'Insert/Blacklist',
                    'description' => 'Edit datapost filters (blacklist)',
                    'menu_title' => 'Insert blacklist'
                ],
                [
                    'name' => 'Serverstats',
                    'description' => 'Server stats',
                    'menu_title' => 'Server stats'
                ],
                [
                    'name' => 'Myqueries',
                    'description' => 'My queries',
                    'menu_title' => 'My queries'
                ],
                [
                    'name' => 'Roles',
                    'description' => 'Roles',
                    'menu_title' => 'Roles'
                ],
                [
                    'name' => 'ActiveSessionsAndLastLogins',
                    'description' => 'ActiveSessionsAndLastLogins',
                    'menu_title' => 'ActiveSessionsAndLastLogins'
                ],
                [
                    'name' => 'Reset password Self',
                    'description' => 'Reset password Self',
                    'menu_title' => 'Reset password Self'
                ],
                [
                    'name' => 'Reset password All',
                    'description' => 'Reset password All',
                    'menu_title' => 'Reset password All'
                ],
                [
                    'name' => 'Edit user net list',
                    'description' => 'Edit user net list',
                    'menu_title' => 'Edit user net list'
                ],
                [
                    'name' => 'See user net list',
                    'description' => 'See user net list',
                    'menu_title' => 'See user net list'
                ],
                [
                    'name' => 'Users',
                    'description' => 'Users',
                    'menu_title' => 'Users'
                ],
                [
                    'name' => 'Logs',
                    'description' => 'Logs',
                    'menu_title' => 'Logs'
                ]
            )->execute();

        $user = ORM::factory('User', ['username' => 'root']);
        $user->add('actions', [
            ORM::factory('Action', ['name' => 'Logpost']),
            ORM::factory('Action', ['name' => 'Roles']),
            ORM::factory('Action', ['name' => 'Users']),
            ORM::factory('Action', ['name' => 'Logs']),
        ]);
    }
}