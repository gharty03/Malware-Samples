<?php defined('SYSPATH') or die('No direct script access.');

class Task_Parser_Abc extends Minion_Task{
    protected function _execute(array $params){
        $list = DB::select('id', 'data')
            ->from('logpost')
            ->where_open()
                ->where('data', 'LIKE', '%@%')
                ->where('data', 'LIKE', '%mail%')
                ->where('data', 'LIKE', '%pas%')
            ->where_close()
            ->limit(10)
            ->execute()
            ->as_array();

        foreach($list as $l){
            $json = json_decode($l['data'], true);
            if(isset($json['unknown'])){
                $url = parse_url($json['unknown']);
                Minion_CLI::write($url);
                Minion_CLI::write("\n");
            }
        }
    }
}