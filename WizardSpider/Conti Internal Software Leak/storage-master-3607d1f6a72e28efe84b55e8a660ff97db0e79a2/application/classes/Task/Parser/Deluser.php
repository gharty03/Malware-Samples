<?php defined('SYSPATH') or die('No direct script access.');

class Task_Parser_Deluser extends Minion_Task{
    protected function _execute(array $params){
//        $list = DB::select()->from('test')->where('ip', '=', '72.5.231.10')->execute()->as_array();
//	    file_put_contents('/root/del.json', json_encode($list));
	    $list = json_decode(
		    file_get_contents('/root/del.json'), true
	    );
	    foreach($list as $l){
		    /* sphinx */
	        DB::query(Database::DELETE, 'DELETE FROM test where id = '.$l['id'])->execute('sphinx');
	        DB::query(Database::DELETE, 'DELETE FROM logpost where test_id = '.$l['id'])->execute('sphinx');
		    /* database */
	        DB::query(Database::DELETE, 'DELETE FROM test where id = '.$l['id'])->execute();
//	        DB::query(Database::DELETE, 'DELETE FROM logpost where test_id = '.$l['id'])->execute();
	    }
    }
}