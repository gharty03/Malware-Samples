<?php defined('SYSPATH') or die('No direct script access.');

class Task_Parser_Parser extends Minion_Task{
    protected function _execute(array $params){
	    $my_words = [
//            '/owa/',
//            'login.secureserver.net',
//		    'login.microsoftonline.com'
	        'access.jpmorgan.com'
	    ];

	    foreach($my_words as $k => $w){
		    $w = trim(
			    Helper::MultiSphinxQL($w)
		    );
		    Minion_CLI::write($w);
		    $name = $this->replacer($w);
		    exec("mysql -e \"SELECT id FROM logpost WHERE MATCH('@link *".$w."*') LIMIT 1000000 OPTION max_matches=1000000\" -h127.0.0.1 -P9317 | tr '\t' ',' > /home/csv/".$name.".csv");
	    }
    }

	public static function replacer($string){
		$from   = array (' ');
		$to = array ('_');
		return str_replace ( $from, $to, $string );
	}
}