<?php defined('SYSPATH') or die('No direct script access.');

class insert_counter_add_action_email extends Migration{

    public function up(){
        /* COUNTER*/
        $model = ORM::factory('Counter');
        $model->name = 'email';
        $model->id = 0;
        $model->save();

        /* ACTION */
        $action = ORM::factory('Action');
        $action->name = 'Email';
        $action->description = 'Emails';
        $action->menu_title = 'Emails';
        $action->save();

        $role = ORM::factory('Role', ['name' => 'admin']);
        $role->add('actions', $action);
    }

    public function down(){
        /* COUNTER*/
        ORM::factory('Counter', ['name' => 'email'])->delete();

        /* ACTION */
        $action = ORM::factory('Action', ['name' => 'Email']);
        $action_roles = ORM::factory('Action_Role')
            ->where('action_id', '=', $action->id)
            ->find_all();
        foreach($action_roles as $action_role) {
            $action_role->delete();
        }

        $action->delete();
    }
}