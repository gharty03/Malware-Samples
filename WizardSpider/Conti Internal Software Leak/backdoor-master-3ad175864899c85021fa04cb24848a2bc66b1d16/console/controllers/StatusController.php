<?php

namespace console\controllers;

use yii\console\Controller;
use Yii;
use common\models\Bots;
use yii\db\Expression;

class StatusController extends Controller
{
    public function actionIndex()
    {
    	// status 0 - off 1 - inline 2 - dead

    	$time = new \DateTime('NOW');
    	$now = $time->format('Y-m-d H:i:s');
    	
    	$seconds_dead = 60 * 60 * 24 * 7; //  1 week
    	$seconds_offline = 60 * 15; // 15 minutes

    	$dead = gmdate('Y-m-d H:i:s',strtotime($now) - $seconds_dead);
    	$offline = gmdate('Y-m-d H:i:s',strtotime($now) - $seconds_offline);

    	//echo gmdate('Y-m-d H:i:s',strtotime($now));
    	//echo chr(10).chr(13);
    	//echo gmdate('Y-m-d H:i:s',strtotime($now) - $seconds_offline);
    	//echo chr(10).chr(13);
    	//$diff = strtotime($model->job_start)
        Bots::updateAll(['status' => 0], ['<=', 'updated_at', $offline]);
        Bots::updateAll(['status' => 2], ['<=', 'updated_at', $dead]);

        exit();
    }

}
